---
description: 
globs: 
alwaysApply: true
---
### **–ü—Ä–∞–≤–∏–ª–∞ —Ä–∞–±–æ—Ç—ã c —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–º *Monito* –≤ Cursor IDE**


---

## 1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è –∫–∞—Ä—Ç–∞ (must-know)

```
monito/
‚îú‚îÄ‚îÄ bot/                  # Telegram UI-—Å–ª–æ–π: –∫–æ–º–∞–Ω–¥—ã, —Ö–µ–Ω–¥–ª–µ—Ä—ã, async-jobs
‚îÇ   ‚îî‚îÄ‚îÄ handlers.py
‚îú‚îÄ‚îÄ parsers/              # –§–æ—Ä–º–∞—Ç-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –∏–∑–≤–ª–µ–∫–∞—Ç–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ excel_parser.py   # Pandas-—á—Ç–µ–Ω–∏–µ .xlsx
‚îÇ   ‚îú‚îÄ‚îÄ pdf_parser.py     # pdfplumber + Camelot
‚îÇ   ‚îî‚îÄ‚îÄ image_parser.py   # OpenCV preproc + OCR
‚îú‚îÄ‚îÄ ocr/                  # –í—ã–∑–æ–≤—ã Vision-LLM –∏ post-OCR –≤–∞–ª–∏–¥–∞—Ü–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ vision_client.py
‚îú‚îÄ‚îÄ normalizer/           # –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏—è –Ω–∞–∑–≤–∞–Ω–∏–π, –µ–¥–∏–Ω–∏—Ü, –±—Ä–µ–Ω–¥–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ name_resolver.py
‚îú‚îÄ‚îÄ storage/              # –ê–¥–∞–ø—Ç–µ—Ä—ã –∫ –ë–î –∏ Google Sheets
‚îÇ   ‚îú‚îÄ‚îÄ db.py
‚îÇ   ‚îî‚îÄ‚îÄ sheets.py
‚îî‚îÄ‚îÄ utils/                # –†–µ–≥—ç–∫—Å–ø—ã, RapidFuzz helpers, logging
    ‚îî‚îÄ‚îÄ ‚Ä¶
```

* **–°–≤—è–∑–∏:**
  `bot.handlers ‚Üí parsers.(excel|pdf|image) ‚Üí ocr.vision_client ‚Üí normalizer.name_resolver ‚Üí storage.(db|sheets)`
  (—Å—Ç—Ä–µ–ª–∫–∏ ‚Äì –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –∏–º–ø–æ—Ä—Ç–æ–≤).
* **–ñ—ë—Å—Ç–∫–æ–µ –ø—Ä–∞–≤–∏–ª–æ:** *–≤–µ—Ä—Ö–Ω–∏–π —Å–ª–æ–π –Ω–µ –º–æ–∂–µ—Ç –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∏–∂–Ω–∏–π* (—á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ —Ü–∏–∫–ª–æ–≤).

---

## 2. –ó–∞–ø—Ä–µ—Ç—ã –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

| ‚Ññ   | –ó–∞–ø—Ä–µ—Ç                                                                                                                                     | –ü–æ—è—Å–Ω–µ–Ω–∏–µ                                      |
| --- | ------------------------------------------------------------------------------------------------------------------------------------------ | ---------------------------------------------- |
| 2.1 | **üö´ –ù–µ–ª—å–∑—è —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–µ –ø–∞–∫–µ—Ç—ã/–º–æ–¥—É–ª–∏** –±–µ–∑ issue-–æ–±—Å—É–∂–¥–µ–Ω–∏—è –∏ –ø–æ–º–µ—Ç–∫–∏ *‚Äúarch-approved‚Äù*.                                              | –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –ø—É—Ç–µ–π –≤–∞–∂–Ω–µ–µ –∫—Ä–æ—à–µ—á–Ω—ã—Ö —É–ª—É—á—à–µ–Ω–∏–π. |
| 2.2 | **üö´ –ù–µ–ª—å–∑—è –º–µ–Ω—è—Ç—å public-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å** —Ñ—É–Ω–∫—Ü–∏–π –≤ `parsers/*`, `ocr/*`, `normalizer/*`, `storage/*` –±–µ–∑ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ –∏–ª–∏ –º–∏–≥—Ä–∞—Ü–∏–∏. | –õ–æ–º–∞–µ—Ç –±–æ—Ç–∞ –∏ CI.                              |
| 2.3 | **üö´ –ù–µ –∫–ª–∞–¥–∏—Ç–µ —Å—Ç–æ—Ä–æ–Ω–Ω–∏–µ –∫–ª—é—á–∏, —Ç–æ–∫–µ–Ω—ã –∏ —Ñ–∞–π–ª—ã > 1 –ú–ë** –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π.                                                                    | –°–µ–∫—å—é—Ä–∏—Ç–∏ –∏ —Ä–∞–∑–º–µ—Ä.                            |
| 2.4 | **üö´ –ù–µ –∫–æ–º–º–∏—Ç—å—Ç–µ auto-formatted JSON –∏–∑ GPT**; —Ö—Ä–∞–Ω–∏—Ç–µ –≤ `tests/fixtures/` –ª–∏—à—å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã.                                      | –®—É–º –≤ –¥–∏—Ñ—Ñ–∞—Ö.                                  |

---

## 3. –†–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–µ —Ç–∏–ø—ã –∏–∑–º–µ–Ω–µ–Ω–∏–π (¬´editor-only work¬ª)

1. **–ü—Ä–∞–≤–∫–∞ –ª–æ–≥–∏–∫–∏ –≤–Ω—É—Ç—Ä–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —Ñ–∞–π–ª–∞** (–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è, bug-fix).
2. **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ unit-—Ç–µ—Å—Ç–æ–≤** –≤ `tests/` —Å –∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ–º `test_<module>_*.py`.
3. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–∫—Å—Ç—Ä–∏–Ω–≥–æ–≤**, type-hint‚Äô–æ–≤, –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤.
4. **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è public-API** (–ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö, —Ä–∞–∑–±–∏–µ–Ω–∏–µ –Ω–∞ –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏).

–ù–æ–≤—ã–π —Ñ–∞–π–ª –¥–æ–ø—É—Å–∫–∞–µ—Ç—Å—è **—Ç–æ–ª—å–∫–æ** –≤–Ω—É—Ç—Ä–∏ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–∞–∫–µ—Ç–∞, –µ—Å–ª–∏:
*—Ñ–∞–π–ª < 400 —Å—Ç—Ä–æ–∫, —á—ë—Ç–∫–æ —Å–ª—É–∂–µ–±–Ω–∞—è —Ä–æ–ª—å (–Ω–∞–ø—Ä–∏–º–µ—Ä `excel_schema.py`) –∏ –≤ Pull Request –µ—Å—Ç—å –ø—É–Ω–∫—Ç ¬´üöÄ minor internal helper ‚Äì –∞—Ä—Ö-–æ–¥–æ–±—Ä–µ–Ω–∏–µ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è¬ª.*

---

## 4. –°—Ç–∞–Ω–¥–∞—Ä—Ç—ã –∫–æ–¥–∞

* **Black + isort + Ruff** –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ—Ñ–æ—Ä–º–∞—Ç—Ç–µ—Ä–æ–º –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏.
* –¢–∏–ø–∏–∑–∞—Ü–∏—è ‚Äì **PEP 604** (`str | None`), –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ –Ω–∞ –ø–∞–±–ª–∏–∫-—Ñ—É–Ω–∫—Ü–∏—è—Ö.
* –í—Å–µ –ø—É–±–ª–∏—á–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ ‚Üí –¥–æ–∫—Å—Ç—Ä–∏–Ω–≥ Google-style.
* –õ–æ–≥–∏ ‚Äì —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ `utils.logger`.
* –ù–∞–∑–≤–∞–Ω–∏—è –≤–µ—Ç–æ–∫: `feat/<ticket>-<slug>` –∏–ª–∏ `fix/<ticket>-<slug>`.

---

## 5. –ü–∞–π–ø–ª–∞–π–Ω Pull Request

1. **CI pre-checks** ‚áí lint + pytest (coverage ‚â• 80 %).
2. **Code Review:** –º–∏–Ω–∏–º—É–º 1 approver —Å —Ç–µ–≥–æ–º *¬´core¬ª*.
3. **Squash-merge:** –µ–¥–∏–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è, —Å–æ–æ–±—â–µ–Ω–∏–µ –≤–∏–¥–∞

   ```
   [TICKET-123] short-title
   ‚Ä¢ why
   ‚Ä¢ what changed
   ‚Ä¢ side-effects
   ```

---

## 6. –†–∞–±–æ—Ç–∞ —Å Cursor IDE

1. **–ü—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–¥–∞ GPT-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–º**
   ‚Ä¢ –û–±—è–∑–∞—Ç–µ–ª–µ–Ω commit-tag `#gpt-gen` –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏.
   ‚Ä¢ –ü–æ—Å–ª–µ –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ ‚Äì —Ä—É—á–Ω–∞—è –ø—Ä–∞–≤–∫–∞ –∏ lint fix.
2. **Autocomplete (Copilot-style) —Ä–∞–∑—Ä–µ—à—ë–Ω**, –Ω–æ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –±–µ–Ω—á–º–∞—Ä–∫ –Ω–∞ —Ç–µ—Å—Ç-–Ω–∞–±–æ—Ä–µ `tests/data/*` –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω.
3. **–ê–≤—Ç–æ—Å–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ Cursor-–æ–º –æ—Ç–∫–ª—é—á–µ–Ω–æ**: `"gpt.createFiles": false` –≤ `.cursor-config.json`.

---

## 7. –ß–µ–∫-–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ push

* [ ] –¢–µ—Å—Ç—ã –∑–µ–ª—ë–Ω—ã–µ (`pytest -q`).
* [ ] `make format && make lint` –±–µ–∑ –æ—à–∏–±–æ–∫.
* [ ] –ù–µ—Ç TODO/FIXME, –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–æ–¥–∞ –≤ –¥–∏—Ñ—Ñ–µ.
* [ ] –ü—É—Ç—å –∏–º–ø–æ—Ä—Ç–∞ –Ω–µ –Ω–∞—Ä—É—à–∞–µ—Ç –≥—Ä–∞—Ñ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (—Å–º. ¬ß1).
* [ ] PR-–æ–ø–∏—Å–∞–Ω–∏–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ –ø–æ —à–∞–±–ª–æ–Ω—É.

